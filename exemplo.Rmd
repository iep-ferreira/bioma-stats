---
title: "Projeto Métricas da Paisagem - Exemplo de uso do Bioma Stats"
author: "CeMECA - UFSCar"
date: "28/08/2024"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,      # Mostra o código no relatório
  message = FALSE,  # Oculta mensagens geradas durante a execução
  warning = FALSE,  # Oculta warnings gerados durante a execução
  error = FALSE     # Oculta erros gerados durante a execução 
  )
```

## Rodando o Bioma Stats

```{r}
library(devtools)
# Se não tiver instalado, vide tutorial ( https://iep-ferreira.github.io/biomastats/ )
#remove.packages("biomastats")
#detach(biomastats)
#devtools::install_github("iep-ferreira/biomastats")
```


```{r}
library(biomastats)
library(mapview)
library(corrplot)
```


## Criando um polígono 

```{r}
(path_package <- system.file(package = "biomastats"))
make_polygon(lat = -22.21199, lon = -49.67772, size = 20, shape = "hexagon")
```


### Criar uma nova área de interesse ou shp 

```{r}
path_shape <- "./shp-exemplos/UFSCar.shp"
mapview(sf::read_sf(path_shape))
```

## usando pasta local com os mapas

```{r, results='hide'}
ufscar_teste_1 <- load_rasters(shape_path = path_shape, start=1985, end=2020,
                               method = "library", import_folder_path = "D:/iuri-external-hd/mapbiomas/colecao-sete")
#save(mapas, file="raster_exemplo.RData")
#load("./raster_exemplo.RData")
```

```{r}
land_vis(ufscar_teste_1, year = 2020)
```

```{r, results='hide'}
ufscar_teste_2 <- load_rasters(shape_path = path_shape, start=1985, end=2020,
                               method = "download", export_folder_path = "./meus-mapas")
#save(mapas, file="raster_exemplo.RData")
#load("./raster_exemplo.RData")
```


```{r}
land_vis(ufscar_teste_2, year = 2010)
```

## Progressão do uso e ocupação do solo

- corrigir o range para ano em get_area

```{r}
#carrega_fonte()
#resultados <- get_area_mod(mapas, plot_type = "profile")
resultados <- get_area(ufscar_teste_1, plot_type = "profile")
```

```{r}
resultados$aggregate_data
resultados$time_series
```

```{r}
obj_teste <- lulc_metrics(ufscar_teste_1$raster[[1]], classe = c(3,4,5,6,7), zone = "20", hemisphere = "south", export.raster = TRUE)
```

```{r}
plot_teste <- biomastats_metrics(ufscar_teste_1,  start = 1985, end = 2020, zone="20", hemisphere ="south")
```

```{r}
plot_teste$metrics_table
```

```{r}
plot_teste <- biomastats_metrics(mapas, start = 1988, end = 2020, zone="20", hemisphere ="south")
```

```{r}
reclass_map(obj = plot_teste, year = 1985)
```

### Classes agrupadas como cobertura natural

```{r}
dicti <- biomastats:::dict_build()
dicti$class[dicti$code %in% plot_teste$classes]
```

### Gráfico da cobertura natural

```{r}
plot_teste$area_plot
```

### Gráfico do tamanho médio dos fragmentos


```{r}
plot_teste$frag_avg_area
```

### Gráfico da densidade de borda

```{r}
plot_teste$edge_density_plot
```

### Gráfico do número de fragmentos

```{r}
plot_teste$fragments_number
```


